

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BirchRest Documentation &mdash; birchrest 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=8d563738"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="birchrest" href="modules.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="#" class="icon icon-home">
            birchrest
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">birchrest</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">birchrest</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">BirchRest Documentation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="birchrest-documentation">
<h1>BirchRest Documentation<a class="headerlink" href="#birchrest-documentation" title="Link to this heading"></a></h1>
<div class="toctree-wrapper compound">
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">birchrest</a><ul>
<li class="toctree-l2"><a class="reference internal" href="birchrest.html">birchrest package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="birchrest.html#subpackages">Subpackages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="birchrest.app.html">birchrest.app package</a></li>
<li class="toctree-l4"><a class="reference internal" href="birchrest.decorators.html">birchrest.decorators package</a></li>
<li class="toctree-l4"><a class="reference internal" href="birchrest.exceptions.html">birchrest.exceptions package</a></li>
<li class="toctree-l4"><a class="reference internal" href="birchrest.http.html">birchrest.http package</a></li>
<li class="toctree-l4"><a class="reference internal" href="birchrest.middlewares.html">birchrest.middlewares package</a></li>
<li class="toctree-l4"><a class="reference internal" href="birchrest.routes.html">birchrest.routes package</a></li>
<li class="toctree-l4"><a class="reference internal" href="birchrest.types.html">birchrest.types package</a></li>
<li class="toctree-l4"><a class="reference internal" href="birchrest.unittest.html">birchrest.unittest package</a></li>
<li class="toctree-l4"><a class="reference internal" href="birchrest.utils.html">birchrest.utils package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="birchrest.html#submodules">Submodules</a></li>
<li class="toctree-l3"><a class="reference internal" href="birchrest.html#birchrest-core-module">birchrest.core module</a></li>
<li class="toctree-l3"><a class="reference internal" href="birchrest.html#module-birchrest.version">birchrest.version module</a></li>
<li class="toctree-l3"><a class="reference internal" href="birchrest.html#module-birchrest">Module contents</a><ul>
<li class="toctree-l4"><a class="reference internal" href="birchrest.html#birchrest.BirchRest"><code class="docutils literal notranslate"><span class="pre">BirchRest</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="birchrest.html#birchrest.Controller"><code class="docutils literal notranslate"><span class="pre">Controller</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="birchrest.html#birchrest.Middleware"><code class="docutils literal notranslate"><span class="pre">Middleware</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<section id="birchrest">
<h2>BirchRest<a class="headerlink" href="#birchrest" title="Link to this heading"></a></h2>
<p><a class="reference internal" href="#LICENSE"><span class="xref myst"><img alt="License: MIT" src="https://img.shields.io/badge/License-MIT-blue.svg" /></span></a>
<a class="reference external" href="https://pypi.org/project/birchrest/"><img alt="Python Versions" src="https://img.shields.io/pypi/pyversions/birchrest.svg" /></a>
<img alt="Unit Tests" src="https://github.com/alexandengstrom/birchrest/actions/workflows/unit_test.yml/badge.svg" />
<img alt="Type Checking" src="https://github.com/alexandengstrom/birchrest/actions/workflows/type_checking.yml/badge.svg" />
<img alt="Linting" src="https://github.com/alexandengstrom/birchrest/actions/workflows/linting.yml/badge.svg" />
<img alt="Security Checks" src="https://github.com/alexandengstrom/birchrest/actions/workflows/security_check.yml/badge.svg" />
<a class="reference external" href="https://codecov.io/gh/alexandengstrom/birchrest"><img alt="codecov" src="https://codecov.io/gh/alexandengstrom/birchrest/branch/main/graph/badge.svg" /></a>
<a class="reference external" href="https://pypi.org/project/birchrest/"><img alt="Downloads" src="https://img.shields.io/pypi/dm/birchrest" /></a>
<a class="reference external" href="https://alexandengstrom.github.io/birchrest/"><img alt="Docs" src="https://img.shields.io/badge/docs-GitHub%20Pages-blue" /></a>
<img alt="GitHub last commit" src="https://img.shields.io/github/last-commit/alexandengstrom/birchrest" />
<img alt="Repo Size" src="https://img.shields.io/github/repo-size/alexandengstrom/birchrest" /></p>
<p><strong>BirchRest</strong> is a simple, lightweight framework for setting up RESTful APIs with minimal configuration. It is designed to be intuitive and flexible.</p>
<p>Full documentation is available here:
https://alexandengstrom.github.io/birchrest</p>
<section id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Link to this heading"></a></h3>
<p>You can install the latest version of birchrest using pip:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">birchrest</span>
</pre></div>
</div>
</section>
<section id="table-of-contents">
<h3>Table of Contents<a class="headerlink" href="#table-of-contents" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#introduction"><span class="xref myst">Introduction</span></a></p></li>
<li><p><a class="reference internal" href="#defining-controllers"><span class="xref myst">Defining Controllers</span></a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#key-concepts"><span class="xref myst">Key Concepts</span></a></p></li>
<li><p><a class="reference internal" href="#defining-endpoints"><span class="xref myst">Defining Endpoints</span></a></p></li>
<li><p><a class="reference internal" href="#nesting-controllers"><span class="xref myst">Nesting Controllers</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="birchrest.html#birchrest.BirchRest.middleware" title="birchrest.BirchRest.middleware"><span class="xref myst py py-meth">Middleware</span></a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#custom-middlewares"><span class="xref myst">Custom Middlewares</span></a></p></li>
<li><p><a class="reference internal" href="#built-in-middlewares"><span class="xref myst">Built-in Middlewares</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#data-validation"><span class="xref myst">Data Validation</span></a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#query-and-url-param-validation"><span class="xref myst">Query and URL Param Validation</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#authentication"><span class="xref myst">Authentication</span></a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#custom-auth-handlers"><span class="xref myst">Custom Auth Handlers</span></a></p></li>
<li><p><a class="reference internal" href="#protecting-routes"><span class="xref myst">Protecting Routes</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#error-handling"><span class="xref myst">Error Handling</span></a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#apierror"><span class="xref myst">ApiError</span></a></p></li>
<li><p><a class="reference internal" href="#custom-error-handler"><span class="xref myst">Custom Error Handler</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#unit-testing"><span class="xref myst">Unit Testing</span></a></p></li>
</ol>
</section>
<section id="introduction">
<h3>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h3>
<p>BirchRest is designed around a controller-based architecture. At runtime, the framework automatically constructs the API from your predefined controllers. For this to work, BirchRest needs access to all the controllers you define. This is achieved by creating a file named <strong>birch</strong>.py, which must import all the controllers you intend to use in your project.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">birchrest</span> <span class="kn">import</span> <span class="n">Controller</span>
<span class="kn">from</span> <span class="nn">birchrest.decorators</span> <span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">controller</span>
<span class="kn">from</span> <span class="nn">birchrest.http</span> <span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span>

<span class="nd">@controller</span><span class="p">(</span><span class="s2">&quot;api&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MyController</span><span class="p">(</span><span class="n">Controller</span><span class="p">):</span>

    <span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">res</span><span class="p">:</span> <span class="n">Response</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello from the app!&quot;</span><span class="p">})</span>
</pre></div>
</div>
<p>To start the server, instantiate the BirchRest class and call its serve method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">birchrest</span> <span class="kn">import</span> <span class="n">BirchRest</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">BirchRest</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">serve</span><span class="p">()</span>
</pre></div>
</div>
<p>Or start the server via command line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>birch<span class="w"> </span>serve<span class="w"> </span>--port<span class="w"> </span><span class="o">[</span>PORT<span class="o">]</span><span class="w"> </span>--host<span class="w"> </span><span class="o">[</span>HOST<span class="o">]</span><span class="w"> </span>--log-level<span class="w"> </span><span class="o">[</span>LOG_LEVEL<span class="o">]</span>
</pre></div>
</div>
</section>
<section id="defining-controllers">
<h3>Defining Controllers<a class="headerlink" href="#defining-controllers" title="Link to this heading"></a></h3>
<p>In Birchrest, controllers are the building blocks of your API. Each controller defines multiple endpoints, and controllers can be nested to create hierarchical routes.</p>
<section id="key-concepts">
<h4>Key Concepts<a class="headerlink" href="#key-concepts" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><strong>Base Path</strong>: Each controller has a base path that defines where its routes are accessible. If a controller has subcontrollers, their base paths are combined, creating a nested structure.</p></li>
<li><p><strong>Controller Setup</strong>: To create a controller:</p>
<ol class="arabic simple">
<li><p>Inherit from the Controller class</p></li>
<li><p>Use the &#64;controller decorator on the class, passing the base path as an argument.</p></li>
</ol>
</li>
</ul>
</section>
<section id="defining-endpoints">
<h4>Defining Endpoints<a class="headerlink" href="#defining-endpoints" title="Link to this heading"></a></h4>
<p>Inside a controller, use HTTP method decorators like &#64;get or &#64;post to define endpoints. These decorators can take an optional path to extend the controller’s base path for that specific route.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an endpoint that accepts PATCH method on route /myendpoint.</span>
<span class="nd">@patch</span><span class="p">(</span><span class="s2">&quot;myendpoint&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">res</span><span class="p">:</span> <span class="n">Response</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">})</span>
</pre></div>
</div>
<p>You can use path variables by using colon in the path and then access them via the request object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;user/:id&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">res</span><span class="p">:</span> <span class="n">Response</span><span class="p">):</span>
    <span class="n">userId</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">userId</span><span class="p">})</span>
</pre></div>
</div>
<p>A route can also access queries in the same way:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">res</span><span class="p">:</span> <span class="n">Response</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">queries</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">})</span>
</pre></div>
</div>
<p>It is possible to set automatic contraints for the body, queries and params via validation decorators. See section about validation.</p>
</section>
<section id="nesting-controllers">
<h4>Nesting Controllers<a class="headerlink" href="#nesting-controllers" title="Link to this heading"></a></h4>
<p>To nest controllers, define a constructor in your parent controller. Inside the constructor, use self.attach() to attach the subcontroller, and don’t forget to call the parent class constructor with super().</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">birchrest</span> <span class="kn">import</span> <span class="n">BirchRest</span><span class="p">,</span> <span class="n">Controller</span>
<span class="kn">from</span> <span class="nn">birchrest.decorators</span> <span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">controller</span>
<span class="kn">from</span> <span class="nn">birchrest.http</span> <span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span>

<span class="nd">@controller</span><span class="p">(</span><span class="s2">&quot;resource&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ResourceController</span><span class="p">(</span><span class="n">Controller</span><span class="p">):</span>
    <span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">res</span><span class="p">:</span> <span class="n">Response</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello from the app!&quot;</span><span class="p">})</span>

<span class="nd">@controller</span><span class="p">(</span><span class="s2">&quot;api&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">BaseController</span><span class="p">(</span><span class="n">Controller</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">ResourceController</span><span class="p">)</span>
</pre></div>
</div>
<p>This will create the endpoint /api/resouce/hello</p>
</section>
</section>
<section id="middleware">
<h3>Middleware<a class="headerlink" href="#middleware" title="Link to this heading"></a></h3>
<p>Middleware allows you to perform tasks before or after a request is processed by a controller, such as logging, modifying the request, or checking permissions. Birchrest provides built-in middleware for common tasks and the ability to define your own custom middleware.</p>
<section id="custom-middlewares">
<h4>Custom Middlewares<a class="headerlink" href="#custom-middlewares" title="Link to this heading"></a></h4>
<p>You can create custom middleware to handle specific logic or modify request and response objects. This section explains how to define and register middleware in your application.</p>
<p>Middleware operates hierarchically, meaning it applies to all routes below the point where it’s defined. You can set up global middleware directly at the application level, or use decorators on controllers and routes. When applied to a controller, the middleware will affect all routes within that controller, as well as any nested controllers attached to it. If applied to a route it will be applied only on that route.</p>
<section id="requirements">
<h5>Requirements<a class="headerlink" href="#requirements" title="Link to this heading"></a></h5>
<p>A middleware should be a class that inherits from the Middleware class and it must implement an async call method. The call method will receive a Request, Response and NextFunction. If the NextFunction is called the call will continue to the next middleware or route handler. If not called, we wont continue. The next function must be awaited.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">birchrest.http</span> <span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span><span class="p">,</span> <span class="n">Middleware</span>
<span class="kn">from</span> <span class="nn">birchrest.types</span> <span class="kn">import</span> <span class="n">NextFunction</span>
<span class="kn">from</span> <span class="nn">birchrest.exceptions</span> <span class="kn">import</span> <span class="n">ApiError</span>

<span class="k">class</span> <span class="nc">MyMiddleware</span><span class="p">(</span><span class="n">Middleware</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>

    <span class="k">async</span> <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">res</span><span class="p">:</span> <span class="n">Response</span><span class="p">,</span> <span class="nb">next</span><span class="p">:</span> <span class="n">NextFunction</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">:</span>
            <span class="k">await</span> <span class="nb">next</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ApiError</span><span class="o">.</span><span class="n">BAD_REQUEST</span><span class="p">()</span>
</pre></div>
</div>
<p>It is possible to execute things after next is called aswell, this means you can use middlewares for postprocessing aswell.</p>
</section>
</section>
<section id="built-in-middlewares">
<h4>Built-in Middlewares<a class="headerlink" href="#built-in-middlewares" title="Link to this heading"></a></h4>
<p>Birchrest comes with several built-in middleware options that help manage common use cases, such as request logging, rate limiting or CORS support. These can be easily added to your API with minimal configuration. These can be imported from the middlewares module.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">birchrest.middlewares</span> <span class="kn">import</span> <span class="n">Cors</span><span class="p">,</span> <span class="n">Logger</span><span class="p">,</span> <span class="n">RateLimiter</span>
</pre></div>
</div>
</section>
</section>
<section id="data-validation">
<h3>Data Validation<a class="headerlink" href="#data-validation" title="Link to this heading"></a></h3>
<p>Data validation in Birchrest is supported via Python data classes. This allows for strict validation of request data (body, queries, and params) to ensure that all incoming data adheres to the expected structure.</p>
<p>To be able to use validation, you must also define the models. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Address</span><span class="p">:</span>
    <span class="n">street</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;min_length&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;max_length&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">})</span>
    <span class="n">city</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;min_length&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;max_length&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">})</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">User</span><span class="p">:</span>
    <span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;min_length&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;max_length&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">})</span>
    <span class="n">email</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;regex&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^[\w\.-]+@[\w\.-]+\.\w+$&quot;</span><span class="p">})</span>
    <span class="n">age</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;min_value&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;max_value&quot;</span><span class="p">:</span> <span class="mi">120</span><span class="p">})</span>
    <span class="n">address</span><span class="p">:</span> <span class="n">Address</span>
</pre></div>
</div>
<p>You can then use the &#64;body, &#64;queries and &#64;params decorator with the dataclass as argument.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@post</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">)</span>
<span class="nd">@body</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">res</span><span class="p">:</span> <span class="n">Response</span><span class="p">):</span>
    <span class="c1"># It is safe to pass the body directly since we have already validated it.</span>
    <span class="n">save_to_database</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="mi">201</span><span class="p">)</span><span class="o">.</span><span class="n">send</span><span class="p">()</span>
</pre></div>
</div>
<p>If the validation fails, the user will get an automatic response. For example, if we try to post a user to the route above but passes a username with only two letters. We will receive this response:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">400</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bad Request&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;correlationId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;67ad2218-262e-478b-b767-04cfafd4315b&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Body validation failed: Field &#39;username&#39; must have at least 3 characters.&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Read more about how automatic error responses are handled in the error section.</p>
<section id="query-and-url-param-validation">
<h4>Query and URL Param Validation<a class="headerlink" href="#query-and-url-param-validation" title="Link to this heading"></a></h4>
<p>Validating queries and params is done in the same way, just use the &#64;queries and &#64;params decorators instead.</p>
</section>
</section>
<section id="authentication">
<h3>Authentication<a class="headerlink" href="#authentication" title="Link to this heading"></a></h3>
<p>Birchrest makes it easy to protect your API routes with authentication mechanisms. It allows you to define custom authentication handlers and easily mark routes as protected, ensuring that only authenticated requests are allowed access.</p>
<section id="custom-auth-handlers">
<h4>Custom Auth Handlers<a class="headerlink" href="#custom-auth-handlers" title="Link to this heading"></a></h4>
<p>You can define your own authentication handler to manage how users are authenticated in your system. Once defined, Birchrest will handle the integration with the API. If your route handler returns a falsy value or raises an Exception, the execution will be stopped. Otherwise the return value from this function will be put under the user property in the request object. It is therefore possible to put information there that tells you which user sent a request.</p>
</section>
<section id="protecting-routes">
<h4>Protecting Routes<a class="headerlink" href="#protecting-routes" title="Link to this heading"></a></h4>
<p>You can easily protect individual routes or entire controllers by marking them as requiring authentication. Birchrest will automatically handle unauthorized access by returning predefined error messages.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">birchrest</span> <span class="kn">import</span> <span class="n">BirchRest</span><span class="p">,</span> <span class="n">Controller</span>
<span class="kn">from</span> <span class="nn">birchrest.decorators</span> <span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">controller</span>
<span class="kn">from</span> <span class="nn">birchrest.http</span> <span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">auth_handler</span><span class="p">(</span><span class="n">req</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">res</span><span class="p">:</span> <span class="n">Response</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Authorization&quot;</span><span class="p">):</span>
        <span class="c1"># Do your logic</span>
        <span class="k">return</span> <span class="p">{</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>

    <span class="k">return</span> <span class="kc">False</span>

<span class="nd">@controller</span><span class="p">(</span><span class="s2">&quot;api&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MyController</span><span class="p">(</span><span class="n">Controller</span><span class="p">):</span>

    <span class="nd">@protected</span><span class="p">()</span>
    <span class="nd">@get</span><span class="p">(</span><span class="s2">&quot;protected&quot;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">res</span><span class="p">:</span> <span class="n">Response</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">send</span><span class="p">({</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello from the app!&quot;</span><span class="p">})</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">BirchRest</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">MyController</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">serve</span><span class="p">()</span>

</pre></div>
</div>
</section>
</section>
<section id="error-handling">
<h3>Error Handling<a class="headerlink" href="#error-handling" title="Link to this heading"></a></h3>
<p>By default, Birchrest will respond will standardized error messages with as good information as possible. For example, 404 when route doesnt exist or 400 if body validation fails. If any unhandled exceptions occurs in the controllers 500 will be returned.</p>
<section id="apierror">
<h4>ApiError<a class="headerlink" href="#apierror" title="Link to this heading"></a></h4>
<p>The error handling is done via the class ApiError. This class is the base class of other exceptions such as NotFound, BadRequest etc. If some of these exceptions is raised, birchrest will know how to respond to the user. By providing a message when raising the exception you can provide more details to the user.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">birchrest.exceptions</span> <span class="kn">import</span> <span class="n">NotFound</span>

<span class="k">raise</span> <span class="n">NotFound</span>
</pre></div>
</div>
<p>This will automatically be converted into a 404 response to the user.</p>
<p>An ApiError exception will have the attributes status_code and base_message which can be 404 and “Not Found” for example. It can also contain the attribute “user_message” if more specific info was given when the exception was raised. For example, if validation fails we will give the user information about why it failed.</p>
</section>
<section id="custom-error-handler">
<h4>Custom Error Handler<a class="headerlink" href="#custom-error-handler" title="Link to this heading"></a></h4>
<p>If you want more control over the error handling, you can catch the exceptions by defining your own error handler. The handler must be callable and will receive a request, response and exception. If a custom error handler is defined it must handle the exception, otherwise 500 internal server error will always be returned to the user.</p>
</section>
</section>
<section id="unit-testing">
<h3>Unit Testing<a class="headerlink" href="#unit-testing" title="Link to this heading"></a></h3>
<p>To simplify testing, the framework includes a test adapter class that simulates sending HTTP requests to your API. This allows you to test everything except the server itself, with all middlewares, authentication handlers, and other components functioning exactly as they would in a real request. The adapter returns the final response object, which you can inspect and assert in your tests.</p>
<p>The TestAdapter class takes an instance of your app and then provides methods like get, post etc that accepts a path, headers and body.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">birchrest</span> <span class="kn">import</span> <span class="n">BirchRest</span>
<span class="kn">from</span> <span class="nn">birchrest.unittest</span> <span class="kn">import</span> <span class="n">TestAdapter</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">BirchRest</span><span class="p">()</span>
<span class="n">runner</span> <span class="o">=</span> <span class="n">TestAdapter</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/your-route&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>BirchRest also provides a custom TestCase class to make it easier to assert responses, example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>

<span class="kn">from</span> <span class="nn">birchrest</span> <span class="kn">import</span> <span class="n">BirchRest</span>
<span class="kn">from</span> <span class="nn">birchrest.unittest</span> <span class="kn">import</span> <span class="n">TestAdapter</span><span class="p">,</span> <span class="n">BirchRestTestCase</span>

<span class="k">class</span> <span class="nc">ApiTest</span><span class="p">(</span><span class="n">BirchRestTestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">BirchRest</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runner</span> <span class="o">=</span> <span class="n">TestAdapter</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">test_user_route</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">runner</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/user&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertOk</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">test_invalid_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">runner</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/user/0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotOk</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertStatus</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="contributing">
<h3>Contributing<a class="headerlink" href="#contributing" title="Link to this heading"></a></h3>
<p>Contributions are welcome! Please refer to the <a class="reference internal" href="#./CONTRIBUTING.md"><span class="xref myst">CONTRIBUTING.md</span></a> file for details on how to get involved, submit pull requests, and report issues.</p>
</section>
<section id="license">
<h3>License<a class="headerlink" href="#license" title="Link to this heading"></a></h3>
<p>This project is licensed under the MIT License - see the <a class="reference internal" href="#./LICENSE"><span class="xref myst">LICENSE</span></a> file for details.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="modules.html" class="btn btn-neutral float-right" title="birchrest" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Alexander Engström.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>